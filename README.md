# CSC574
Implement the Email Security System.
Write a program that has three main functions:
A)    A mini-database utility to keep track of the certificates that you have acquired from the course web site
B)     A method to send encrypted and signed email
C)     A method to verify and decrypt received email
Below are the important details of your program
 
A) Message Format:
 
from: emailID,to: emailID
-----BEGIN CSC574 MESSAGE-----
<session pwd encrypted under target’s public key>
<blank line>
<message encrypted under session pwd above>
<blank line>
<signature of above content>
-----END CSC574 MESSAGE-----
 
 
• First -----BEGIN CSC574 MESSAGE----- must appear exactly as shown; this is the indicator that the message begins immediately after this line. (This allows the message to be embedded in a bunch of other text without confusing the recipient’s parser.)
• The next line is the session password encrypted under the target’s public key. This password is a random string of 32 characters using A-Z, a-z, and 0-9 generated by the sender; the sender then encrypts his message with AES in CBC mode using this password.
• There is a blank line, followed by the AES-CBC encrypted message in base64 format. This is followed by another blank line.
• Next comes the signature of the sender which is generated using the sender’s private key. This signature will be the RSA signature of the SHA-1 hash of every line above from the first line after the BEGIN marker to the line just before the blank line ending the message.
• Finally, -----END CSC574 MESSAGE----- concludes the encrypted message.
 
B) The Certificates Database:
Your program should maintain a simple text file catalog of certificates, which you have collected from the course web site. A certificate should always be verified using the CA’s public key before being inserted into the database. A certificate should always be verified using the CA’s public key after being extracted from the database (to ensure someone hasn’t tampered with it while you weren’t watching). You need not store the person’s email address in your database since this is embedded in the certificate, but it might be easier to go ahead and store the email addresses as an index field in the file.
 
 
C) Sending Secure Mail:
Your program should accept a plain-text message along with a destinatio email address and output an encrypted and signed message as described above. Here is the algorithm:
1. Get the cert of the target from the database, using the email address as the index; if the email is not there, you must extract it from the course web page.
2. Verify the signature on this cert for your email target.
3. Generate a 32-character passphrase. Normally we would use a very strong random-number generator for this, but feel free to use random() or the rand function of OpenSSL if you like.
4. Encrypt the message with AES in CBC mode with the session key and a random IV (OpenSSL does this for you). Use base64 encoding, and save the output.
5. Encrypt the session password with the target’s public key.
6. Sign the stuff generated so far as described previously, using SHA-1 and your private key (you will need to type in your passphrase to do this).
7. Format and send.
 
D) Receiving Secure Mail:
This is how you will process incoming secure email:
1. Obtain sender’s email address from mail header
2. Find the sender’s certificate in your database, or obtain from the class website. Verify sender’s certificate is signed by CA; output sender name from the certificate (not from the email header!)
3. Verify signature on received message using SHA-1 and public key of sender. If invalid, reject the message. Else, continue.
4. Decrypt session key with your private key (you will need to type in your passphrase for this).
5. Use session key to decrypt message; print out resulting message.
 
 
E) Hints:
• You already know many of the OpenSSL commands you will need for this project; using the command-line interface is probably the easiest way to get this task done.
• You can call the command-line interface from C or C++, or you can write your whole system in Perl, Python, or sh.
• A text-based menu system is fine, but if you want to build a GUI, feel  free.
• Don’t wait until the last minute to start this project!
 
Here is what you need to turn in:
(A)  Complete source for your program
(B)  An example run of each of the main functions (list database, send msg, receive msg)
(C)  Runs on the test messages the CA will send to each of you, showing the outputs]]
